name: 'Publish npm package'
description: 'Publish npm package'
inputs:
  package-name:
    description: 'Name of package'
    required: true
  package-dir:
    description: 'Directory of package'
    required: true

runs:
  using: composite
  steps:
    - name: Set path filter
      uses: dorny/paths-filter@v2
      id: path-filter
      with:
        filters: |
          ${{ inputs.package-name }}:
            - '${{inputs.package-dir}}/**'

    - name: Commit message check
      id: check-strategy
      if: steps.path-filter.outputs[inputs.package-name] == 'true'
      shell: bash
      run: |
        isMinor=${{ contains(github.event.head_commit.message, 'feat(${{ inputs.package-name }})') }}
        isPatch=${{ contains(github.event.head_commit.message, 'fix(${{ inputs.package-name }})') }}
        
        if [$isMinor == 'true']
        then
          echo "::set-output name=strategy::minor"
        elif [$isPatch == 'true']
        then
          echo "::set-output name=strategy::patch"
        else
          echo "::set-output name=strategy::patch"
        fi

    - name: Publish
      if: steps.path-filter.outputs[inputs.package-name] == 'true'
      shell: bash
      run: yarn workspace @difuks/${{ inputs.package-name }} version ${{ steps.check-strategy.outputs.strategy }}

    - uses: stefanzweifel/git-auto-commit-action@v4
      if: steps.path-filter.outputs[inputs.package-name] == 'true'
      with:
        commit_message: 'ci: Up ${{ inputs.package-name }} ${{ steps.check-strategy.outputs.strategy }} version'
